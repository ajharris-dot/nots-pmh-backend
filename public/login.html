<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sign in</title>
  <link rel="stylesheet" href="/styles.css"/>
  <style>
    /* tiny center layout */
    .login-wrap{min-height:100dvh;display:grid;place-items:center;padding:24px;}
    .login-card{max-width:420px;width:100%;background:#fff;border:1px solid var(--line);
      border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .login-card h1{margin:0 0 12px 0;font-size:20px}
  </style>
</head>
<body>
  <div class="login-wrap">
    <div class="login-card">
      <h1>Sign in</h1>
      <form id="loginForm">
        <label>Email
          <input id="loginEmail" type="email" required/>
        </label>
        <label>Password
          <input id="loginPassword" type="password" required/>
        </label>
        <div class="modal-actions" style="justify-content:flex-start">
          <button class="primary" type="submit">Sign in</button>
        </div>
      </form>
      <div id="loginMsg" class="muted" style="margin-top:8px;"></div>
    </div>
  </div>

  <script>
    const AUTH='/api/auth', TOKEN_KEY='authToken';
    const setToken = t => localStorage.setItem(TOKEN_KEY, t);
    const getToken = () => localStorage.getItem(TOKEN_KEY) || '';

    // If already authed, go to app
    if (getToken()) window.location.replace('/');

    const form = document.getElementById('loginForm');
    const msg  = document.getElementById('loginMsg');

    form?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent='';
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      try{
        const res = await fetch(`${AUTH}/login`,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, password })
        });
        if(!res.ok){
          const t = await res.text().catch(()=> '');
          msg.textContent = `Login failed: ${t || res.status}`;
          return;
        }
        const data = await res.json();
        if(data?.token){
          setToken(data.token);
          window.location.replace('/');
        }else{
          msg.textContent='Login failed: no token returned';
        }
      }catch(err){
        msg.textContent='Network error during login.';
      }
    });
  </script>
</body>
</html>
